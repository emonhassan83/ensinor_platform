// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         String     @id @default(uuid())
  email      String     @unique
  password   String
  role       UserRole
  lastActive DateTime   @default(now())
  status     UserStatus @default(active)
  isDeleted  Boolean    @default(false)
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt

  superAdmin         SuperAdmin?
  companyAdmin       CompanyAdmin?
  businessInstructor BusinessInstructor?
  employee           Employee?
  instructor         Instructor?
  student            Student?
  subscription       Subscription?
  payment            Payment?
  review             Review?
  reviewRef          ReviewRef?
  notification       Notification[]
  messagesSent       Message[]            @relation("SentMessages")
  messagesReceived   Message[]            @relation("ReceivedMessages")
  chatParticipant    ChatParticipant[]
  book               Book[]
  order              Order[]
  course             Course[]
  courseBundle       CourseBundle[]
  event              Event[]
  eventBooking       EventBooking[]
  article            Article[]
  content            Content[]
  batch              Batch[]
  createdCoupons     Coupon[]             @relation("CouponCreated")
  usedCoupons        Coupon[]             @relation("CouponUsedBy")
  quizAttempt        QuizAttempt[]
  certificateRequest CertificateRequest[]

  @@map("users")
}

model SuperAdmin {
  id          String     @id @unique @default(uuid())
  userId      String     @unique
  name        String
  email       String     @unique
  photoUrl    String
  dateOfBirth String
  contactNo   String
  city        String?
  country     String?
  status      UserStatus @default(active)
  isDeleted   Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  user User @relation(references: [id], fields: [userId])

  @@map("super_admin")
}

model CompanyAdmin {
  id          String     @id @unique @default(uuid())
  userId      String     @unique
  name        String
  email       String     @unique
  photoUrl    String
  dateOfBirth String
  contactNo   String
  city        String?
  country     String?
  status      UserStatus @default(active)
  isDeleted   Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  user               User                @relation(references: [id], fields: [userId])
  businessInstructor BusinessInstructor?
  employee           Employee?
  company            Company?

  @@map("company_admins")
}

model BusinessInstructor {
  id          String     @id @unique @default(uuid())
  userId      String     @unique
  companyId   String     @unique
  name        String
  email       String     @unique
  photoUrl    String
  dateOfBirth String
  contactNo   String
  city        String?
  country     String?
  status      UserStatus @default(active)
  isDeleted   Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  user    User         @relation(references: [id], fields: [userId])
  company CompanyAdmin @relation(references: [id], fields: [companyId])

  @@map("business_instructors")
}

model Employee {
  id          String     @id @unique @default(uuid())
  userId      String     @unique
  companyId   String     @unique
  name        String
  email       String     @unique
  photoUrl    String
  dateOfBirth String
  contactNo   String
  city        String?
  country     String?
  status      UserStatus @default(active)
  isDeleted   Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  user    User         @relation(references: [id], fields: [userId])
  company CompanyAdmin @relation(references: [id], fields: [companyId])

  @@map("employees")
}

model Instructor {
  id          String     @id @unique @default(uuid())
  userId      String     @unique
  name        String
  email       String     @unique
  photoUrl    String
  contactNo   String
  designation String
  bio         String?
  city        String?
  country     String?
  university  String?
  session     String?
  subjects    String
  linkedIn    String?
  facebook    String?
  twitter     String?
  instagram   String?
  website     String?
  avgRating   Float      @default(0.0)
  ratingCount Int        @default(0)
  status      UserStatus @default(active)
  isDeleted   Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  user User @relation(references: [id], fields: [userId])

  @@map("instructors")
}

model Student {
  id          String     @id @unique @default(uuid())
  userId      String     @unique
  name        String
  email       String     @unique
  photoUrl    String
  bio         String?
  interests   String[]
  dateOfBirth String
  contactNo   String
  city        String?
  country     String?
  university  String?
  session     String?
  subjects    String
  status      UserStatus @default(active)
  isDeleted   Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  user User @relation(references: [id], fields: [userId])

  @@map("students")
}

model Company {
  id           String     @id @default(uuid())
  userId       String     @unique
  name         String
  industryType String
  logo         String?
  color        String?
  employee     Int        @default(0)
  instructor   Int        @default(0)
  size         Int        @default(0)
  status       UserStatus @default(active)
  isDeleted    Boolean    @default(false)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  author CompanyAdmin @relation(references: [id], fields: [userId])

  @@map("companies")
}

model Book {
  id            String     @id @default(uuid())
  authorId      String
  title         String
  description   String?
  writer        String
  category      String
  price         Float
  thumbnails    String
  file          String
  popularity    Int        @default(0)
  publishedDate DateTime?
  status        UserStatus @default(pending)
  isDeleted     Boolean    @default(false)
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  author User    @relation(fields: [authorId], references: [id]) // FK relation to User table
  order  Order[]

  @@map("books")
}

model Order {
  id            String        @id @default(uuid()) // Primary Key
  userId        String // FK to User table (customer)
  bookId        String // FK to Author/User table
  amount        Float
  status        OrderStatus   @default(pending)
  paymentStatus PaymentStatus @default(unpaid)
  transactionId String?
  documents     String[] // Array of document URLs or file paths
  isDeleted     Boolean       @default(false)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  user User @relation(fields: [userId], references: [id])
  book Book @relation(fields: [bookId], references: [id])

  @@map("orders")
}

model Course {
  id               String      @id @default(uuid()) // Primary Key
  authorId         String // FK to User (Instructor)
  title            String
  shortDescription String
  category         String
  level            CourseLevel
  language         String
  points           Int         @default(0)
  deadline         String?
  price            Float
  description      String
  thumbnail        String?
  lectures         Int         @default(0)
  duration         String?
  hasCertificate   Boolean     @default(false)
  popularity       Int         @default(0)
  totalCompleted   Int         @default(0)
  status           UserStatus  @default(pending)
  avgRating        Float       @default(0.0)
  ratingCount      Int         @default(0)
  isDeleted        Boolean     @default(false)
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt

  author             User                 @relation(fields: [authorId], references: [id])
  bundles            CourseBundle[]       @relation("BundleCourses") // Many-to-Many relation with CourseBundle
  quiz               Quiz[]
  certificateRequest CertificateRequest[]

  @@map("courses")
}

model CourseBundle {
  id          String   @id @default(uuid()) // Primary Key
  authorId    String // FK to User (Instructor)
  description String
  price       Float
  discount    Float    @default(0.0)
  isDeleted   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  author  User     @relation(fields: [authorId], references: [id])
  courses Course[] @relation("BundleCourses")

  @@map("course_bundles")
}

model Quiz {
  id           String   @id @default(uuid()) // PK
  courseId     String
  deadline     String?
  time         String? // e.g. "30m" or "01:00:00"
  questions    Int      @default(0)
  totalAttempt Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  course        Course        @relation(fields: [courseId], references: [id])
  questionsList Question[]
  quizAttempt   QuizAttempt[]

  @@map("quizzes")
}

model Question {
  id        String   @id @default(uuid()) // PK
  quizId    String
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  quiz    Quiz      @relation(fields: [quizId], references: [id])
  options Options[]

  @@map("questions")
}

model Options {
  id          String   @id @default(uuid()) // PK
  questionId  String
  optionLevel String // e.g. A, B, C, D
  optionText  String
  isCorrect   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  question Question @relation(fields: [questionId], references: [id])

  @@map("options")
}

model QuizAttempt {
  id            String   @id @default(uuid()) // PK
  quizId        String
  userId        String
  timeTaken     String? // e.g. "15m", "00:12:45"
  marksObtained Int      @default(0)
  totalMarks    Int
  grade         String?
  correctRate   Float    @default(0.0) // % of correct answers
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  quiz Quiz @relation(fields: [quizId], references: [id])
  user User @relation(fields: [userId], references: [id])

  @@map("quiz_attempts")
}

model CertificateRequest {
  id         String     @id @default(uuid()) // PK
  authorId   String // FK to User (student requesting)
  courseId   String // FK to Course
  status     UserStatus @default(pending)
  isComplete Boolean    @default(false)
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt

  // Relations
  author User   @relation(fields: [authorId], references: [id])
  course Course @relation(fields: [courseId], references: [id])

  @@map("certificate_requests")
}

model Event {
  id             String     @id @default(uuid()) // Primary Key
  authorId       String // FK to User
  title          String
  slogan         String
  type           String
  thumbnail      String
  organizedBy    String
  price          Float
  location       String
  date           String
  startTime      String
  endTime        String
  description    String
  speakerSlogan  String
  scheduleSlogan Boolean    @default(false)
  registered     Int        @default(0)
  status         UserStatus @default(pending)
  isDeleted      Boolean    @default(false)
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  author       User           @relation(fields: [authorId], references: [id])
  eventBooking EventBooking[]

  @@map("events")
}

model EventBooking {
  id            String        @id @default(uuid()) // Primary Key
  eventId       String
  userId        String
  name          String
  phone         String
  email         String
  organization  String
  profession    String
  city          String
  country       String
  amount        Float
  status        OrderStatus   @default(pending)
  paymentStatus PaymentStatus @default(unpaid)
  transactionId String
  document      String?
  isDeleted     Boolean       @default(false)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  event Event @relation(fields: [eventId], references: [id])
  user  User  @relation(fields: [userId], references: [id])

  @@map("event_bookings")
}

model Coupon {
  id       String @id @default(uuid()) // Primary Key
  authorId String // FK → User (who created the coupon)

  modelType   CouponModel // Enum to represent reference type (Course, Event, etc.)
  referenceId String // Generic FK (depending on modelType)

  name     String
  expireAt DateTime
  code     String   @unique
  discount Float

  // Relations
  author User   @relation("CouponCreated", fields: [authorId], references: [id])
  usedBy User[] @relation("CouponUsedBy")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("coupons")
}

model Package {
  id           String              @id @default(uuid())
  title        String
  logo         String
  audience     PackageAudience
  features     String[]
  billingCycle PackageBillingCycle
  price        Int
  popularity   Int                 @default(0)
  isDeleted    Boolean             @default(false)
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  subscription Subscription?

  @@map("packages")
}

model Subscription {
  id            String        @id @default(uuid())
  packageId     String        @unique
  userId        String        @unique
  transactionId String?
  amount        Float
  paymentStatus PaymentStatus
  status        PaymentStatus
  expiredAt     DateTime      @default(now())
  isExpired     Boolean       @default(false)
  isDeleted     Boolean       @default(false)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  package Package @relation(references: [id], fields: [packageId])
  user    User    @relation(references: [id], fields: [userId])

  @@map("subscriptions")
}

model Payment {
  id              String           @id @default(uuid())
  userId          String           @unique
  referenceId     String
  modelType       PaymentModelType
  transactionId   String           @unique
  amount          Float            @default(0.00)
  commission      Float            @default(0.00)
  status          PaymentStatus    @default(unpaid)
  paymentMethod   String
  paymentIntentId String?
  isPaid          Boolean          @default(false)
  isSellerPaid    Boolean          @default(false)
  isDeleted       Boolean          @default(false)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  account User @relation(references: [id], fields: [userId])

  @@map("payments")
}

model Batch {
  id       String @id @default(uuid()) // Primary Key
  authorId String // FK → User (Instructor / Creator)

  title       String
  description String
  image       String?
  category    String
  rarity      String?
  popularity  Int     @default(0)

  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  author User @relation(fields: [authorId], references: [id])

  @@map("batches")
}

model Review {
  id          String          @id @default(uuid())
  userId      String          @unique
  referenceId String
  modelType   ReviewModelType
  rating      Float
  comment     String
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  author    User       @relation(references: [id], fields: [userId])
  ReviewRef ReviewRef?

  @@map("reviews")
}

model ReviewRef {
  id        String   @id @default(uuid())
  userId    String   @unique
  reviewId  String   @unique
  comment   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  author User   @relation(references: [id], fields: [userId])
  review Review @relation(references: [id], fields: [reviewId])

  @@map("review_refs")
}

model Notification {
  id          String               @id @default(uuid())
  receiverId  String?
  referenceId String?
  model_type  NotificationModeType
  message     String
  description String               @default("")
  date        DateTime             @default(now())
  read        Boolean              @default(false)
  isDeleted   Boolean              @default(false)
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt

  receiver User? @relation(fields: [receiverId], references: [id])

  @@map("notifications")
}

model Chat {
  id           String            @id @default(uuid())
  participants ChatParticipant[]
  type         String // e.g., "private", "group"
  groupName    String? // Optional, for group chats
  groupImage   String? // Optional, for group chats
  status       ChatStatus        @default(accepted)
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt

  messages Message[]

  @@map("chats")
}

model ChatParticipant {
  id     String @id @default(uuid())
  userId String @unique
  chatId String @unique

  user User @relation(fields: [userId], references: [id])
  chat Chat @relation(fields: [chatId], references: [id])

  @@unique([userId, chatId])
  @@map("chat_participants")
}

model Message {
  id       String   @id @default(uuid())
  text     String?
  imageUrl String[]
  seen     Boolean  @default(false)

  sender   User   @relation("SentMessages", fields: [senderId], references: [id])
  senderId String

  receiver   User   @relation("ReceivedMessages", fields: [receiverId], references: [id])
  receiverId String

  chat   Chat   @relation(fields: [chatId], references: [id])
  chatId String @unique

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("messages")
}

model Article {
  id          String   @id @default(uuid()) // Primary Key
  authorId    String // FK to User
  title       String
  category    String
  thumbnail   String?
  description String
  seen        Int      @default(0)
  isDeleted   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  author User @relation(fields: [authorId], references: [id])

  @@map("articles")
}

model Content {
  id          String @id @default(uuid()) // Primary Key
  createdById String // FK to User (admin/editor)

  aboutUs            String?
  termsAndConditions String?
  privacyPolicy      String?

  // Support / Contacts
  supports         Int     @default(0)
  customerLocation String?
  customerNumber   String?
  customerEmail    String?

  contractLocation String?
  contractNumber   String?
  contractEmail    String?

  officeLocation String?
  officeNumber   String?
  officeEmail    String?

  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  createdBy User  @relation(fields: [createdById], references: [id])
  faq       FAQ[] // one Content can have multiple FAQs

  @@map("contents")
}

model FAQ {
  id        String @id @default(uuid()) // Primary Key
  contentId String // FK → Content

  question String
  answer   String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  content Content @relation(fields: [contentId], references: [id])

  @@map("faqs")
}

model Support {
  id        String   @id @default(uuid()) // Primary Key
  name      String
  email     String
  message   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("supports")
}

enum UserRole {
  super_admin
  company_admin
  business_instructors
  employee
  instructor
  student
}

enum PackageAudience {
  company_admin
  student
}

enum PackageBillingCycle {
  monthly
  halfYearly
  annually
}

enum PaymentModelType {
  order
  subscription
  eventBooking
  enrolledCourse
}

enum ReviewModelType {
  instructor
  course
}

enum NotificationModeType {
  courses
  users
  quiz
  orders
  payments
  events
}

enum UserStatus {
  pending
  active
  blocked
  deleted
}

enum Gender {
  male
  female
  unknown
}

enum OrderStatus {
  pending
  completed
  cancelled
  refunded
}

enum CourseLevel {
  beginner
  intermediate
  advanced
  expert
}

enum CouponModel {
  courses
  events
  books
}

enum PaymentStatus {
  unpaid
  paid
  failed
  refunded
}

enum ChatStatus {
  accepted
  blocked
}
