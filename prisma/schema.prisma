// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Verification {
  id        String    @id @default(uuid())
  otp       String
  expiresAt DateTime?
  status    Boolean   @default(false)

  // One-to-One relation
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("verifications")
}

enum RegisterWith {
  google
  linkedIn
  facebook
  credentials
}

// User model: Core authentication and common profile info for all roles
model User {
  id                  String       @id @default(uuid())
  name                String
  email               String       @unique
  password            String?
  photoUrl            String?
  bio                 String?
  dateOfBirth         String?
  contactNo           String?
  city                String?
  country             String?
  role                UserRole     @default(student)
  packageExpiry       DateTime?
  fcmToken            String?
  points              Int          @default(0)
  registerWith        RegisterWith
  lastActive          DateTime     @default(now())
  needsPasswordChange Boolean      @default(true)
  passwordChangedAt   DateTime     @default(now())
  expireAt            DateTime?
  status              UserStatus   @default(pending)
  avgRating           Float        @default(0.0)
  ratingCount         Int          @default(0)
  isDeleted           Boolean      @default(false)
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt

  superAdmin                 SuperAdmin?
  companyAdmin               CompanyAdmin?
  businessInstructor         BusinessInstructor?
  employee                   Employee?
  instructor                 Instructor?
  student                    Student?
  subscription               Subscription?
  payment                    Payment?
  reviewRef                  ReviewRef[]
  notification               Notification[]
  messagesSent               Message[]            @relation("SentMessages")
  messagesReceived           Message[]            @relation("ReceivedMessages")
  chatParticipant            ChatParticipant[]
  book                       Book[]
  order                      Order[]
  course                     Course[]
  event                      Event[]
  eventBooking               EventBooking[]
  article                    Article[]
  content                    Content[]
  batch                      Batch[]
  createdCoupons             Coupon[]             @relation("CouponCreated")
  usedCoupons                Coupon[]             @relation("CouponUsedBy")
  quizAttempt                QuizAttempt[]
  department                 Department[]
  invitation                 Invitation[]
  enrolledCourse             EnrolledCourse[]
  certificate                Certificate[]
  wishlist                   Wishlist[]
  withdrawRequest            WithdrawRequest[]
  gradingSystem              GradingSystem[]
  bundlesAuthored            CourseBundle[]       @relation("BundleAuthor")
  verification               Verification?
  companyRequest             CompanyRequest[]
  usersOnArticles            UsersOnArticles[]
  cv                         CV?
  zoomAccount                ZoomAccount[]
  promoCode                  PromoCode[]
  usePromoCode               PromoCode[]          @relation("PromoCodeUsedBy")
  affiliate                  Affiliate[]
  meetingAssignmentsAuthored MeetingAssignment[]  @relation("MeetingAssignmentsAuthored")
  meetingAssignmentsJoined   MeetingAssignment[]  @relation("MeetingAssignmentsJoined")
  review                     Review[]
  companyBusinessInstructor  BusinessInstructor[] @relation("company")
  companyEmployee            Employee[]           @relation("companyUser")
  quiz                       Quiz[]
  studentRequest             CertificateRequest[] @relation("studentRequest")
  authorRequest              CertificateRequest[] @relation("authorRequest")

  @@map("users")
}

model ZoomAccount {
  id           String   @id @default(uuid())
  userId       String
  accessToken  String
  refreshToken String
  expiresAt    DateTime
  zoomUserId   String
  email        String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  user     User          @relation(fields: [userId], references: [id])
  meetings ZoomMeeting[]

  @@map("zoom_accounts")
}

model ZoomMeeting {
  id            String   @id @default(uuid())
  zoomAccountId String
  zoomMeetingId String   @unique
  topic         String
  agenda        String
  startUrl      String
  joinUrl       String
  password      String?
  duration      Int
  startTime     DateTime
  endTime       DateTime
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  zoomAccount       ZoomAccount         @relation(fields: [zoomAccountId], references: [id])
  meetingAssignment MeetingAssignment[]

  @@map("zoom_meetings")
}

model MeetingAssignment {
  id            String              @id @default(uuid())
  authorId      String
  modelType     AssignmentModelType
  courseId      String?
  eventId       String?
  userId        String?
  zoomMeetingId String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  // Relations
  zoomMeeting ZoomMeeting @relation(fields: [zoomMeetingId], references: [id])
  course      Course?     @relation(fields: [courseId], references: [id])
  event       Event?      @relation(fields: [eventId], references: [id])
  // User Relations
  author      User        @relation("MeetingAssignmentsAuthored", fields: [authorId], references: [id])
  user        User?       @relation("MeetingAssignmentsJoined", fields: [userId], references: [id])

  @@map("meeting_assignments")
}

enum AssignmentModelType {
  course
  event
  user
}

model SuperAdmin {
  id        String   @id @unique @default(uuid())
  userId    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(references: [id], fields: [userId])

  @@map("super_admin")
}

model CompanyAdmin {
  id        String   @id @unique @default(uuid())
  userId    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user    User     @relation(references: [id], fields: [userId])
  company Company?

  @@map("company_admins")
}

model Company {
  id           String   @id @default(uuid())
  userId       String   @unique
  name         String
  industryType String
  logo         String?
  color        String?
  employee     Int      @default(0)
  instructor   Int      @default(0)
  size         Int      @default(0)
  isDeleted    Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  author CompanyAdmin @relation(references: [id], fields: [userId])

  @@map("companies")
}

model CompanyRequest {
  id                    String     @id @default(uuid())
  userId                String
  name                  String
  organizationEmail     String     @unique
  companyType           String
  phoneNumber           String
  role                  String
  companySize           Int
  numberOfPeopleToTrain Int
  trainingNeeds         Int
  description           String
  status                UserStatus @default(pending)
  createdAt             DateTime   @default(now())
  updatedAt             DateTime   @updatedAt

  user User @relation(references: [id], fields: [userId])

  @@map("company_requests")
}

model Department {
  id        String   @id @default(uuid())
  authorId  String
  name      String
  image     String
  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  author     User         @relation(fields: [authorId], references: [id])
  invitation Invitation[]
  employee   Employee[]

  @@map("departments")
}

model Invitation {
  id           String   @id @default(uuid())
  userId       String
  departmentId String
  name         String
  groupName    String?
  email        String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  user       User       @relation(fields: [userId], references: [id])
  department Department @relation(fields: [departmentId], references: [id])

  @@unique([userId, departmentId]) // Composite Unique (like PK across both)
  @@map("invitations")
}

model BusinessInstructor {
  id          String   @id @unique @default(uuid())
  userId      String   @unique
  designation String
  university  String?
  session     String?
  subjects    String?
  linkedIn    String?
  facebook    String?
  twitter     String?
  instagram   String?
  website     String?
  avgRating   Float    @default(0.0)
  ratingCount Int      @default(0)
  companyId   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user    User @relation(references: [id], fields: [userId])
  company User @relation("company", references: [id], fields: [companyId])

  @@map("business_instructors")
}

model Employee {
  id           String   @id @unique @default(uuid())
  userId       String   @unique
  interests    String[] @default([])
  university   String?
  session      String?
  subjects     String?
  companyId    String
  departmentId String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  user       User       @relation(references: [id], fields: [userId])
  company    User       @relation("companyUser", references: [id], fields: [companyId])
  department Department @relation(references: [id], fields: [departmentId])

  @@map("employees")
}

model Instructor {
  id          String   @id @unique @default(uuid())
  userId      String   @unique
  designation String
  experience  Int? // in year
  university  String?
  session     String?
  subjects    String?
  linkedIn    String?
  facebook    String?
  twitter     String?
  instagram   String?
  website     String?
  avgRating   Float    @default(0.0)
  ratingCount Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user User @relation(references: [id], fields: [userId])

  @@map("instructors")
}

model Student {
  id         String   @id @unique @default(uuid())
  userId     String   @unique
  interests  String[]
  university String?
  session    String?
  subjects   String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  user User @relation(references: [id], fields: [userId])

  @@map("students")
}

// Book Related Models
model Book {
  id            String     @id @default(uuid())
  authorId      String
  title         String
  description   String?
  writer        String
  category      String
  price         Float
  thumbnail     String?
  file          String
  popularity    Int        @default(0)
  publishedDate String?
  status        BookStatus @default(inReview)
  isDeleted     Boolean    @default(false)
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  author    User        @relation(fields: [authorId], references: [id]) // FK relation to User table
  order     Order[]
  coupon    Coupon[]
  promoCode PromoCode[]
  wishlist  Wishlist[]
  resource  Resource[]

  @@map("books")
}

model Order {
  id             String         @id @default(uuid())
  userId         String
  modelType      OrderModelType
  bookId         String?
  courseId       String?
  courseBundleId String?
  amount         Float
  status         OrderStatus    @default(pending)
  paymentStatus  PaymentStatus  @default(unpaid)
  paymentMethod  PaymentMethod  @default(Stripe)
  transactionId  String?
  documents      String[] // Array of document URLs or file paths
  isDeleted      Boolean        @default(false)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  user          User            @relation(fields: [userId], references: [id])
  affiliateSale AffiliateSale[]

  book         Book?         @relation(fields: [bookId], references: [id])
  course       Course?       @relation(fields: [courseId], references: [id])
  courseBundle CourseBundle? @relation(fields: [courseBundleId], references: [id])
  payment      Payment[]

  @@map("orders")
}

enum OrderModelType {
  book
  course
  courseBundle
}

// Course Related Models
model Course {
  id               String        @id @default(uuid())
  authorId         String
  title            String
  shortDescription String
  category         String
  level            CourseLevel
  language         String
  points           Int           @default(0)
  deadline         String?
  price            Float
  description      String
  thumbnail        String?
  lectures         Int           @default(0)
  duration         Int           @default(0)
  hasCertificate   Boolean       @default(false)
  isFreeCourse     Boolean       @default(false)
  popularity       Int           @default(0)
  totalCompleted   Int           @default(0)
  status           CoursesStatus @default(pending)
  avgRating        Float         @default(0.0)
  ratingCount      Int           @default(0)
  isDeleted        Boolean       @default(false)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  author User @relation(fields: [authorId], references: [id])

  // Many-to-many with CourseBundle via join table
  courseBundleCourses CourseBundleCourses[]
  bundles             CourseBundle[]        @relation("BundleCourses")

  courseContent      CourseContent[]
  quiz               Quiz[]
  certificateRequest CertificateRequest[]
  enrolledCourse     EnrolledCourse[]
  certificate        Certificate[]
  gradingSystem      GradingSystem[]
  affiliateLink      AffiliateLink[]
  affiliateSale      AffiliateSale[]
  meetingAssignment  MeetingAssignment[]
  order              Order[]
  coupon             Coupon[]
  promoCode          PromoCode[]
  review             Review[]
  wishlist           Wishlist[]
  resource           Resource[]

  @@map("courses")
}

model CourseContent {
  id        String   @id @default(uuid())
  courseId  String
  title     String
  video     String
  duration  Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  course Course @relation(fields: [courseId], references: [id])

  @@map("course_contents")
}

model CourseBundle {
  id             String     @id @default(uuid())
  authorId       String
  title          String
  category       String
  price          Int
  thumbnail      String?
  discount       Int        @default(0)
  popularity     Int        @default(0)
  totalCompleted Int        @default(0)
  status         UserStatus @default(active)
  avgRating      Float      @default(0.0)
  ratingCount    Int        @default(0)
  isDeleted      Boolean    @default(false)
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  // Relations
  author User @relation("BundleAuthor", fields: [authorId], references: [id])

  // Many-to-many handled through join table
  courseBundleCourses CourseBundleCourses[]
  courses             Course[]              @relation("BundleCourses")
  order               Order[]

  @@map("course_bundles")
}

model CourseBundleCourses {
  bundleId String
  courseId String

  bundle CourseBundle @relation(fields: [bundleId], references: [id])
  course Course       @relation(fields: [courseId], references: [id])

  @@id([bundleId, courseId])
  @@map("course_bundle_courses")
}

model Quiz {
  id           String   @id @default(uuid())
  authorId     String
  courseId     String
  deadline     String?
  time         String? // e.g. "30m" or "01:00:00"
  marks        Int?
  questions    Int      @default(0)
  totalAttempt Int      @default(0)
  isDeleted    Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  course        Course        @relation(fields: [courseId], references: [id])
  author        User          @relation(fields: [authorId], references: [id])
  questionsList Question[]
  quizAttempt   QuizAttempt[]

  @@map("quizzes")
}

model Question {
  id        String   @id @default(uuid())
  quizId    String
  name      String
  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  quiz    Quiz      @relation(fields: [quizId], references: [id])
  options Options[]

  @@map("questions")
}

model Options {
  id          String   @id @default(uuid())
  questionId  String
  optionLevel String // e.g. A, B, C, D
  optionText  String
  isCorrect   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  question Question @relation(fields: [questionId], references: [id])

  @@map("options")
}

model QuizAttempt {
  id            String   @id @default(uuid())
  quizId        String
  userId        String
  timeTaken     String? // e.g. "15m", "00:12:45"
  marksObtained Int      @default(0)
  totalMarks    Int      @default(0)
  grade         String?
  correctRate   Float    @default(0.0) // % of correct answers
  isDeleted     Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  quiz Quiz @relation(fields: [quizId], references: [id])
  user User @relation(fields: [userId], references: [id])

  @@map("quiz_attempts")
}

model EnrolledCourse {
  id            String       @id @default(uuid())
  authorId      String
  courseId      String
  completedRate Int          @default(0)
  courseMark    Int?         @default(0)
  grade         CourseGrade?
  learningTime  Int          @default(0) // in minutes
  isComplete    Boolean      @default(false)
  isDeleted     Boolean      @default(false)
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt

  author User   @relation(fields: [authorId], references: [id])
  course Course @relation(fields: [courseId], references: [id])

  @@map("enrolled_courses")
}

enum CourseGrade {
  A
  B
  C
  D
  F
}

model CertificateRequest {
  id        String                   @id @default(uuid())
  userId    String // FK to User (course author)
  authorId  String // FK to User (student requesting)
  courseId  String
  status    CertificateRequestStatus @default(pending)
  createdAt DateTime                 @default(now())
  updatedAt DateTime                 @updatedAt

  // Relations
  author User   @relation("authorRequest", fields: [authorId], references: [id])
  user   User   @relation("studentRequest", fields: [userId], references: [id])
  course Course @relation(fields: [courseId], references: [id])

  @@map("certificate_requests")
}

enum CertificateRequestStatus {
  pending
  completed
  denied
}

model Certificate {
  id           String   @id @default(uuid())
  authorId     String
  courseId     String
  company      String
  logo         String
  student      String
  courseName   String
  instructor   String
  studyHour    Float
  topics       String[]
  completeDate String
  reference    String
  signature    String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  course Course @relation(fields: [courseId], references: [id])
  author User   @relation(fields: [authorId], references: [id])

  @@map("certificates")
}

//* Event Related Models
model Event {
  id             String   @id @default(uuid())
  authorId       String
  title          String
  slogan         String
  type           String
  thumbnail      String
  organizedBy    String
  price          Int
  location       String
  date           String
  startTime      String
  endTime        String
  description    String
  speakerSlogan  String
  scheduleSlogan String
  registered     Int      @default(0)
  isDeleted      Boolean  @default(false)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  author            User                @relation(fields: [authorId], references: [id])
  eventBooking      EventBooking[]
  eventSchedule     EventSchedule[]
  eventSpeaker      EventSpeaker[]
  MeetingAssignment MeetingAssignment[]
  coupon            Coupon[]
  promoCode         PromoCode[]
  resource          Resource[]

  @@map("events")
}

model EventSchedule {
  id        String   @id @default(uuid())
  eventId   String
  day       String
  date      String
  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  event        Event          @relation(fields: [eventId], references: [id])
  eventSpeaker EventSpeaker[]

  @@map("event_schedules")
}

model EventSpeaker {
  id              String   @id @default(uuid())
  eventId         String
  eventScheduleId String
  name            String
  photo           String?
  profession      String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  event    Event         @relation(fields: [eventId], references: [id])
  schedule EventSchedule @relation(fields: [eventScheduleId], references: [id])

  @@map("event_speakers")
}

model EventBooking {
  id            String        @id @default(uuid())
  eventId       String
  userId        String
  name          String
  phone         String
  email         String
  organization  String
  profession    String
  city          String
  country       String
  amount        Float
  status        OrderStatus   @default(pending)
  paymentStatus PaymentStatus @default(unpaid)
  transactionId String?
  document      String?
  isDeleted     Boolean       @default(false)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  event Event @relation(fields: [eventId], references: [id])
  user  User  @relation(fields: [userId], references: [id])

  @@map("event_bookings")
}

model Coupon {
  id       String @id @default(uuid())
  authorId String // FK → User (who created the coupon)

  modelType CouponModel // Enum to represent reference type (Course, Event, etc.)
  bookId    String?
  courseId  String?
  eventId   String?

  name      String
  code      String   @unique
  discount  Float
  maxUsage  Int?
  usedCount Int      @default(0)
  expireAt  DateTime
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  author User   @relation("CouponCreated", fields: [authorId], references: [id])
  usedBy User[] @relation("CouponUsedBy")

  book   Book?   @relation(fields: [bookId], references: [id])
  course Course? @relation(fields: [courseId], references: [id])
  event  Event?  @relation(fields: [eventId], references: [id])

  @@map("coupons")
}

model PromoCode {
  id        String      @id @default(uuid())
  authorId  String
  modelType CouponModel
  bookId    String?
  courseId  String?
  eventId   String?
  name      String
  code      String      @unique
  discount  Float
  maxUsage  Int?
  usedCount Int         @default(0)
  expireAt  DateTime
  isActive  Boolean     @default(true)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  author User?   @relation(fields: [authorId], references: [id])
  usedBy User[]  @relation("PromoCodeUsedBy")
  book   Book?   @relation(fields: [bookId], references: [id])
  course Course? @relation(fields: [courseId], references: [id])
  event  Event?  @relation(fields: [eventId], references: [id])

  @@map("promo_codes")
}

model Affiliate {
  id             String   @id @default(uuid())
  userId         String
  commissionRate Float    @default(0.15) // 15% default
  totalClicks    Int      @default(0)
  totalSales     Int      @default(0)
  totalEarnings  Float    @default(0)
  pendingAmount  Float    @default(0)
  paidAmount     Float    @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  user           User            @relation(fields: [userId], references: [id])
  affiliateLinks AffiliateLink[]
  affiliateSales AffiliateSale[]

  @@map("affiliates")
}

model AffiliateLink {
  id          String   @id @default(uuid())
  affiliateId String
  courseId    String
  link        String   @unique
  clicks      Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  affiliate Affiliate @relation(fields: [affiliateId], references: [id])
  course    Course    @relation(fields: [courseId], references: [id])

  @@map("affiliate_links")
}

model AffiliateSale {
  id          String   @id @default(uuid())
  affiliateId String
  courseId    String
  orderId     String
  commission  Float
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  affiliate Affiliate @relation(fields: [affiliateId], references: [id])
  course    Course    @relation(fields: [courseId], references: [id])
  order     Order     @relation(fields: [orderId], references: [id])

  @@map("affiliate_sales")
}

model Package {
  id           String              @id @default(uuid())
  title        String
  type         String
  logo         String
  audience     PackageAudience
  features     String[]
  billingCycle PackageBillingCycle
  price        Int
  popularity   Int                 @default(0)
  isDeleted    Boolean             @default(false)
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt

  subscription Subscription?

  @@map("packages")
}

model Subscription {
  id            String             @id @default(uuid())
  packageId     String             @unique
  userId        String             @unique
  type          SubscriptionType
  transactionId String?
  amount        Float
  paymentStatus PaymentStatus
  status        SubscriptionStatus
  expiredAt     DateTime           @default(now())
  isExpired     Boolean            @default(false)
  isDeleted     Boolean            @default(false)
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt

  package Package   @relation(references: [id], fields: [packageId])
  user    User      @relation(references: [id], fields: [userId])
  payment Payment[]

  @@map("subscriptions")
}

enum SubscriptionType {
  basic
  standard
  premium
  non_profits
  most_popular
  full_power
}

enum SubscriptionStatus {
  pending
  active
  cancelled
  expired
}

model Payment {
  id              String           @id @default(uuid())
  userId          String           @unique
  orderId         String?
  subscriptionId  String?
  modelType       PaymentModelType
  transactionId   String           @unique
  amount          Float            @default(0.00)
  commission      Float            @default(0.00)
  status          PaymentStatus    @default(unpaid)
  paymentMethod   String
  paymentIntentId String?
  isPaid          Boolean          @default(false)
  isSellerPaid    Boolean          @default(false)
  isDeleted       Boolean          @default(false)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  account      User          @relation(references: [id], fields: [userId])
  order        Order?        @relation(fields: [orderId], references: [id])
  subscription Subscription? @relation(fields: [subscriptionId], references: [id])

  @@map("payments")
}

model Batch {
  id       String @id @default(uuid())
  authorId String // FK → User (Instructor / Creator)

  title       String
  description String
  logo        String?
  category    String
  rarity      String?
  popularity  Int     @default(0)

  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  author User @relation(fields: [authorId], references: [id])

  @@map("batches")
}

model Review {
  id        String   @id @default(uuid())
  authorId  String
  courseId  String
  rating    Float
  comment   String
  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  author    User        @relation(fields: [authorId], references: [id])
  course    Course?     @relation(references: [id], fields: [courseId])
  reviewRef ReviewRef[]

  @@map("reviews")
}

model ReviewRef {
  id        String   @id @default(uuid())
  userId    String
  reviewId  String
  comment   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  author User   @relation(references: [id], fields: [userId])
  review Review @relation(references: [id], fields: [reviewId])

  @@map("review_refs")
}

model WithdrawRequest {
  id               String         @id @default(uuid())
  userId           String
  amount           Float
  stripeTransferId String?
  paymentMethod    PaymentMethod
  status           WithdrawStatus @default(pending)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt

  user User @relation(fields: [userId], references: [id])

  @@map("withdraw_requests")
}

enum PaymentMethod {
  Stripe
  PayPal
  BankTransfer
}

model CV {
  id          String   @id @default(uuid())
  userId      String   @unique
  name        String
  designation String
  photo       String
  phone       String
  email       String
  linkedin    String
  website     String
  location    String
  aboutMe     String
  skills      String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user User @relation(fields: [userId], references: [id])

  educations   Education[]
  experiences  Experience[]
  certificates CVCertificate[]

  @@map("cvs")
}

model Education {
  id          String   @id @default(uuid())
  cvId        String
  institution String
  degree      String
  location    String
  result      String
  startTime   String
  endTime     String
  type        String // eg. GPA or CGPA
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  cv CV @relation(fields: [cvId], references: [id])

  @@map("educations")
}

model Experience {
  id          String   @id @default(uuid())
  cvId        String
  companyName String
  designation String
  jobType     String
  startTime   String
  endTime     String
  description String
  skills      String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  cv CV @relation(fields: [cvId], references: [id])

  @@map("experiences")
}

model CVCertificate {
  id            String   @id @default(uuid())
  cvId          String
  instituteName String
  degree        String
  credentialId  String
  file          String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  cv CV @relation(fields: [cvId], references: [id])

  @@map("cv_certificates")
}

model Notification {
  id          String               @id @default(uuid())
  receiverId  String?
  referenceId String?
  modeType    NotificationModeType
  message     String
  description String               @default("")
  date        DateTime             @default(now())
  read        Boolean              @default(false)
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt

  receiver User? @relation(fields: [receiverId], references: [id])

  @@map("notifications")
}

model Chat {
  id         String     @id @default(uuid())
  type       ChatType
  groupName  String? // Optional, for group chats
  groupImage String? // Optional, for group chats
  status     ChatStatus @default(accepted)
  isDeleted  Boolean    @default(false)
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt

  participants ChatParticipant[]
  messages     Message[]

  @@map("chats")
}

model ChatParticipant {
  id     String @id @default(uuid())
  userId String
  chatId String

  user User @relation(fields: [userId], references: [id])
  chat Chat @relation(fields: [chatId], references: [id])

  @@unique([userId, chatId])
  @@map("chat_participants")
}

enum ChatType {
  private
  group
}

model Message {
  id         String   @id @default(uuid())
  senderId   String
  chatId     String
  receiverId String?
  text       String
  imageUrl   String[] @default([])
  seen       Boolean  @default(false)

  sender User @relation("SentMessages", fields: [senderId], references: [id])

  receiver User? @relation("ReceivedMessages", fields: [receiverId], references: [id])

  chat Chat @relation(fields: [chatId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("messages")
}

model Wishlist {
  id        String            @id @default(uuid())
  userId    String
  modelType WishListModelType
  bookId    String?
  courseId  String?
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt

  user   User    @relation(fields: [userId], references: [id])
  book   Book?   @relation(fields: [bookId], references: [id])
  course Course? @relation(fields: [courseId], references: [id])

  @@map("wishlists")
}

enum WishListModelType {
  course
  book
}

model Resource {
  id        String            @id @default(uuid())
  name      String
  modelType ResourceModelType
  bookId    String?
  courseId  String?
  eventId   String?
  articleId String?
  file      String
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt

  book    Book?    @relation(fields: [bookId], references: [id])
  course  Course?  @relation(fields: [courseId], references: [id])
  event   Event?   @relation(fields: [eventId], references: [id])
  article Article? @relation(fields: [articleId], references: [id])

  @@map("resources")
}

enum ResourceModelType {
  course
  event
  article
  book
}

model GradingSystem {
  id        String   @id @default(uuid())
  courseId  String?
  authorId  String
  isDefault Boolean  @default(false) // true = SuperAdmin template
  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  author User?   @relation(fields: [authorId], references: [id])
  course Course? @relation(fields: [courseId], references: [id])
  grades Grade[]

  @@map("grading_systems")
}

model Grade {
  id              String      @id @default(uuid())
  gradingSystemId String
  minScore        Float
  maxScore        Float
  gradeLabel      CourseGrade // e.g., "A", "B", "C"
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  gradingSystem GradingSystem @relation(fields: [gradingSystemId], references: [id])

  @@map("grades")
}

model Article {
  id          String   @id @default(uuid())
  authorId    String // FK to Admin
  title       String
  category    String
  thumbnail   String?
  description String
  seen        Int      @default(0)
  isDeleted   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  author   User              @relation(fields: [authorId], references: [id])
  seenBy   UsersOnArticles[] // ✅ join table for tracking who has seen
  resource Resource[]

  @@map("articles")
}

model UsersOnArticles {
  userId    String
  articleId String
  seenAt    DateTime @default(now()) // ✅ track when they saw it

  user    User    @relation(fields: [userId], references: [id])
  article Article @relation(fields: [articleId], references: [id])

  @@id([userId, articleId]) // Composite PK
  @@map("users_on_articles")
}

model Content {
  id          String @id @default(uuid())
  createdById String // FK to User (admin/editor)

  aboutUs            String?
  termsAndConditions String?
  privacyPolicy      String?

  // Support / Contacts
  supports         String?
  customerLocation String?
  customerNumber   String?
  customerEmail    String?

  contractLocation String?
  contractNumber   String?
  contractEmail    String?

  officeLocation String?
  officeNumber   String?
  officeEmail    String?

  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  createdBy User @relation(fields: [createdById], references: [id])

  @@map("contents")
}

model FAQ {
  id       String @id @default(uuid())
  question String
  answer   String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("faqs")
}

model Support {
  id         String   @id @default(uuid())
  name       String
  email      String
  message    String
  isResponse Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("supports")
}

model Newsletter {
  id           String           @id @default(uuid())
  email        String           @unique // Subscriber email
  recurrence   RecurrenceType   @default(once) // How often to send newsletter
  scheduleDate DateTime         @default(now()) // Next scheduled date for sending
  status       NewsletterStatus @default(active)
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt

  @@map("newsletters")
}

enum RecurrenceType {
  once
  daily
  weekly
  monthly
}

enum NewsletterStatus {
  active
  paused
  unsubscribed
}

enum UserRole {
  super_admin
  company_admin
  business_instructors
  employee
  instructor
  student
}

enum PackageAudience {
  company_admin
  instructor
}

enum PackageBillingCycle {
  monthly
  halfYearly
  annually
}

enum PaymentModelType {
  order
  subscription
}

enum ReviewModelType {
  instructor
  course
}

enum NotificationModeType {
  courses
  users
  quiz
  orders
  payments
  events
}

enum UserStatus {
  pending
  active
  denied
  blocked
  deleted
}

enum CoursesStatus {
  pending
  approved
  denied
}

enum BookStatus {
  inReview
  inPublishing
  published
}

enum Gender {
  male
  female
  unknown
}

enum OrderStatus {
  pending
  completed
  cancelled
  refunded
}

enum WithdrawStatus {
  pending
  completed
  cancelled
}

enum CourseLevel {
  beginner
  intermediate
  advanced
  expert
}

enum CouponModel {
  courses
  events
  books
}

enum PaymentStatus {
  unpaid
  paid
  failed
  refunded
}

enum ChatStatus {
  accepted
  blocked
}
