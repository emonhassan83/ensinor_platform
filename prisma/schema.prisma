// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Verification {
  id        String    @id @default(uuid())
  otp       String
  expiresAt DateTime?
  status    Boolean   @default(false)

  // One-to-One relation
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("verifications")
}

// User model: Core authentication and common profile info for all roles
model User {
  id                  String       @id @default(uuid())
  name                String
  email               String       @unique
  password            String?
  photoUrl            String?
  bio                 String?
  dateOfBirth         String?
  contactNo           String?
  city                String?
  country             String?
  role                UserRole     @default(student)
  packageExpiry       DateTime?
  fcmToken            String?
  points              Int          @default(0)
  freePoints          Int          @default(0)
  badges              String[]     @default([])
  balance             Float        @default(0.0)
  registerWith        RegisterWith
  lastActive          DateTime     @default(now())
  needsPasswordChange Boolean      @default(true)
  passwordChangedAt   DateTime     @default(now())
  expireAt            DateTime?
  stripeAccountId     String?
  status              UserStatus   @default(pending)
  avgRating           Float        @default(0.0)
  ratingCount         Int          @default(0)
  isDeleted           Boolean      @default(false)
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt

  superAdmin                 SuperAdmin?
  companyAdmin               CompanyAdmin?
  businessInstructor         BusinessInstructor?
  employee                   Employee?
  instructor                 Instructor?
  student                    Student?
  subscription               Subscription?
  paymentUserAccount         Payment[]              @relation("PaymentUserAccount")
  PaymentAuthorAccount       Payment[]              @relation("PaymentAuthorAccount")
  reviewRef                  ReviewRef[]
  notification               Notification[]
  messagesSent               Message[]              @relation("SentMessages")
  messagesReceived           Message[]              @relation("ReceivedMessages")
  chatParticipant            ChatParticipant[]
  book                       Book[]
  userOrder                  Order[]                @relation("UserOrder")
  authorOrder                Order[]                @relation("AuthorOrder")
  courseAuthor               Course[]               @relation("CourseAuthor")
  courseInstructor           Course[]               @relation("CourseInstructor")
  event                      Event[]
  userEventBooking           EventBooking[]         @relation("userEventBooking")
  authorEventBooking         EventBooking[]         @relation("authorEventBooking")
  article                    Article[]
  content                    Content[]
  batch                      Batch[]
  createdCoupons             Coupon[]               @relation("CouponCreated")
  usedCoupons                Coupon[]               @relation("CouponUsedBy")
  quizAttemptUser            QuizAttempt[]          @relation("quizAttemptUser")
  quizAuthor                 QuizAttempt[]          @relation("quizAuthor")
  department                 Department[]
  invitation                 Invitation[]
  enrolledCourseUser         EnrolledCourse[]       @relation("EnrolledUser")
  enrolledCourseAuthor       EnrolledCourse[]       @relation("CourseAuthor")
  userCertificate            Certificate[]          @relation("UserCertificate")
  authorCertificate          Certificate[]          @relation("AuthorCertificate")
  wishlist                   Wishlist[]
  withdrawRequest            WithdrawRequest[]
  gradingSystem              GradingSystem[]
  authorCourseBundle         CourseBundle[]         @relation("BundleAuthor")
  verification               Verification?
  usersOnArticles            UsersOnArticles[]
  cv                         CV?
  zoomAccount                ZoomAccount[]
  promoCode                  PromoCode[]
  usePromoCode               PromoCode[]            @relation("PromoCodeUsedBy")
  affiliate                  Affiliate?
  meetingAssignmentsAuthored MeetingAssignment[]    @relation("MeetingAssignmentsAuthored")
  meetingAssignmentsJoined   MeetingAssignment[]    @relation("MeetingAssignmentsJoined")
  review                     Review[]
  companyBusinessInstructor  BusinessInstructor[]   @relation("companyAuthor")
  companyEmployee            Employee[]             @relation("companyUser")
  quiz                       Quiz[]
  studentRequest             CertificateRequest[]   @relation("studentRequest")
  authorRequest              CertificateRequest[]   @relation("authorRequest")
  resource                   Resource[]
  coInstructorsInvited       CoInstructor[]         @relation("InvitedByRelation")
  coInstructorRoles          CoInstructor[]         @relation("CoInstructorRelation")
  assignment                 Assignment[]
  assignmentAuthor           AssignmentSubmission[] @relation("assignmentAuthorUser")
  assignmentSubmission       AssignmentSubmission[] @relation("assignmentSubmissionUser")
  bankDetail                 BankDetail?
  affiliateSale              AffiliateSale[]
  cart                       Cart[]

  @@map("users")
}

model ZoomAccount {
  id           String   @id @default(uuid())
  userId       String
  accessToken  String
  refreshToken String
  expiresAt    DateTime
  zoomUserId   String
  email        String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  user     User          @relation(fields: [userId], references: [id])
  meetings ZoomMeeting[]

  @@map("zoom_accounts")
}

model ZoomMeeting {
  id            String   @id @default(uuid())
  zoomAccountId String
  zoomMeetingId String   @unique
  topic         String
  agenda        String
  startUrl      String
  joinUrl       String
  password      String?
  duration      Int
  startTime     DateTime
  endTime       DateTime
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  zoomAccount       ZoomAccount         @relation(fields: [zoomAccountId], references: [id])
  meetingAssignment MeetingAssignment[]

  @@map("zoom_meetings")
}

model MeetingAssignment {
  id            String              @id @default(uuid())
  authorId      String
  modelType     AssignmentModelType
  courseId      String?
  eventId       String?
  userId        String?
  zoomMeetingId String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  // Relations
  zoomMeeting ZoomMeeting @relation(fields: [zoomMeetingId], references: [id])
  course      Course?     @relation(fields: [courseId], references: [id])
  event       Event?      @relation(fields: [eventId], references: [id])
  // User Relations
  author      User        @relation("MeetingAssignmentsAuthored", fields: [authorId], references: [id])
  user        User?       @relation("MeetingAssignmentsJoined", fields: [userId], references: [id])

  @@map("meeting_assignments")
}

model SuperAdmin {
  id        String   @id @unique @default(uuid())
  userId    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(references: [id], fields: [userId])

  @@map("super_admin")
}

model CompanyAdmin {
  id        String   @id @unique @default(uuid())
  userId    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user    User     @relation(references: [id], fields: [userId])
  company Company?

  @@map("company_admins")
}

model Company {
  id           String      @id @default(uuid())
  userId       String      @unique
  name         String
  industryType CompanyType
  logo         String?
  color        String?
  employee     Int         @default(0)
  instructor   Int         @default(0)
  size         Int         @default(0)
  courses      Int         @default(0)
  enrolled     Int         @default(0)
  completed    Int         @default(0)
  isActive     Boolean     @default(false)
  isDeleted    Boolean     @default(false)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  author             CompanyAdmin         @relation(references: [id], fields: [userId])
  course             Course[]
  courseBundle       CourseBundle[]
  event              Event[]
  businessInstructor BusinessInstructor[]
  employees          Employee[]
  payment            Payment[]
  Book               Book[]

  @@map("companies")
}

model CompanyRequest {
  id                    String      @id @default(uuid())
  name                  String
  organizationEmail     String      @unique
  platformType          CompanyType
  phoneNumber           String
  companySize           String
  numberOfPeopleToTrain String
  description           String
  status                UserStatus  @default(pending)
  createdAt             DateTime    @default(now())
  updatedAt             DateTime    @updatedAt

  @@map("company_requests")
}

model Department {
  id        String   @id @default(uuid())
  authorId  String
  name      String
  image     String
  joined    Int      @default(0)
  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  author     User         @relation(fields: [authorId], references: [id])
  invitation Invitation[]
  employee   Employee[]

  @@map("departments")
}

model Invitation {
  id           String   @id @default(uuid())
  userId       String
  departmentId String
  name         String
  groupName    String?
  email        String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  user       User       @relation(fields: [userId], references: [id])
  department Department @relation(fields: [departmentId], references: [id])

  @@unique([userId, departmentId]) // Composite Unique (like PK across both)
  @@map("invitations")
}

model BusinessInstructor {
  id          String   @id @unique @default(uuid())
  userId      String   @unique
  authorId    String   @unique
  companyId   String
  designation String
  university  String?
  session     String?
  subjects    String?
  linkedIn    String?
  facebook    String?
  twitter     String?
  instagram   String?
  website     String?
  avgRating   Float    @default(0.0)
  ratingCount Int      @default(0)
  courses     Int      @default(0)
  enrolled    Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user    User    @relation(references: [id], fields: [userId])
  author  User    @relation("companyAuthor", references: [id], fields: [authorId])
  company Company @relation(references: [id], fields: [companyId])

  @@map("business_instructors")
}

model CoInstructor {
  id             String       @id @default(uuid())
  courseId       String
  invitedById    String
  coInstructorId String
  revenueShare   Float        @default(0.35)
  permissions    Permission[]
  isActive       Boolean      @default(true)
  isDeleted      Boolean      @default(false)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  // Relations
  course              Course                @relation(fields: [courseId], references: [id])
  invitedBy           User                  @relation("InvitedByRelation", fields: [invitedById], references: [id])
  coInstructorUser    User                  @relation("CoInstructorRelation", fields: [coInstructorId], references: [id])
  coInstructorEarning CoInstructorEarning[]

  @@map("co_instructors")
}

model Employee {
  id              String   @id @unique @default(uuid())
  userId          String   @unique
  authorId        String
  companyId       String
  interests       String[] @default([])
  university      String?
  session         String?
  subjects        String?
  departmentId    String
  courseEnrolled  Int      @default(0)
  courseCompleted Int      @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  user       User       @relation(references: [id], fields: [userId])
  author     User       @relation("companyUser", references: [id], fields: [authorId])
  company    Company    @relation(references: [id], fields: [companyId])
  department Department @relation(references: [id], fields: [departmentId])

  @@map("employees")
}

model Instructor {
  id          String   @id @unique @default(uuid())
  userId      String   @unique
  designation String
  experience  Int? // in year
  university  String?
  session     String?
  subjects    String?
  linkedIn    String?
  facebook    String?
  twitter     String?
  instagram   String?
  website     String?
  avgRating   Float    @default(0.0)
  ratingCount Int      @default(0)
  courses     Int      @default(0)
  enrolled    Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user User @relation(references: [id], fields: [userId])

  @@map("instructors")
}

model Student {
  id              String   @id @unique @default(uuid())
  userId          String   @unique
  interests       String[]
  university      String?
  session         String?
  subjects        String
  courseEnrolled  Int      @default(0)
  courseCompleted Int      @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  user User @relation(references: [id], fields: [userId])

  @@map("students")
}

model BankDetail {
  id             String   @id @default(uuid())
  authorId       String   @unique
  accountNumber  String
  routingNumber  String?
  bankName       String
  bankHolderName String
  bankAddress    String
  isDeleted      Boolean  @default(false)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  author User @relation(fields: [authorId], references: [id])

  @@map("bank_details")
}

model Book {
  id            String       @id @default(uuid())
  authorId      String
  companyId     String?
  platform      PlatformType @default(admin)
  title         String
  description   String?
  writer        String
  category      String
  price         Float
  thumbnail     String?
  file          String
  sales         Int          @default(0)
  publishedDate String?
  status        BookStatus   @default(inReview)
  isDeleted     Boolean      @default(false)
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt

  author  User     @relation(fields: [authorId], references: [id]) // FK relation to User table
  company Company? @relation(fields: [companyId], references: [id]) // FK relation to Company table

  order         Order[]
  coupon        Coupon[]
  promoCode     PromoCode[]
  wishlist      Wishlist[]
  resource      Resource[]
  affiliateLink AffiliateLink[]
  cart          Cart[]

  @@map("books")
}

// Course Related Models
model Course {
  id               String        @id @default(uuid())
  authorId         String
  instructorId     String
  companyId        String?
  title            String
  shortDescription String
  platform         PlatformType  @default(admin)
  type             CourseType    @default(external)
  category         String
  level            CourseLevel
  language         String
  deadline         String?
  price            Float
  description      String
  thumbnail        String?
  lectures         Int           @default(0)
  duration         Int           @default(0)
  hasCertificate   Boolean       @default(false)
  isFreeCourse     Boolean       @default(false)
  enrollments      Int           @default(0)
  totalCompleted   Int           @default(0)
  status           CoursesStatus @default(pending)
  avgRating        Float         @default(0.0)
  ratingCount      Int           @default(0)
  isDeleted        Boolean       @default(false)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  author     User     @relation("CourseAuthor", fields: [authorId], references: [id])
  instructor User     @relation("CourseInstructor", fields: [instructorId], references: [id])
  companies  Company? @relation(fields: [companyId], references: [id])

  // Many-to-many with CourseBundle via join table
  courseBundleCourses CourseBundleCourses[]
  bundles             CourseBundle[]        @relation("BundleCourses")

  courseContent      CourseContent[]
  quiz               Quiz[]
  certificateRequest CertificateRequest[]
  enrolledCourse     EnrolledCourse[]
  certificate        Certificate[]
  gradingSystem      GradingSystem[]
  affiliateLink      AffiliateLink[]
  meetingAssignment  MeetingAssignment[]
  order              Order[]
  coupon             Coupon[]
  promoCode          PromoCode[]
  review             Review[]
  wishlist           Wishlist[]
  resource           Resource[]
  coInstructor       CoInstructor[]
  assignment         Assignment[]
  chat               Chat[]
  cart               Cart[]

  @@map("courses")
}

model CourseContent {
  id        String   @id @default(uuid())
  courseId  String
  title     String
  video     String
  duration  Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  course    Course           @relation(fields: [courseId], references: [id])
  // Many-to-many relation with EnrolledCourse
  watchedBy EnrolledCourse[] @relation("CourseLectureWatched")

  @@map("course_contents")
}

model CourseBundle {
  id             String       @id @default(uuid())
  authorId       String
  companyId      String?
  platform       PlatformType
  title          String
  category       String
  price          Int
  thumbnail      String?
  discount       Int          @default(0)
  enrollments    Int          @default(0)
  totalCompleted Int          @default(0)
  avgRating      Float        @default(0.0)
  ratingCount    Int          @default(0)
  isDeleted      Boolean      @default(false)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  // Relations
  author  User     @relation("BundleAuthor", fields: [authorId], references: [id])
  company Company? @relation(fields: [companyId], references: [id])

  // Many-to-many handled through join table
  courseBundleCourses CourseBundleCourses[]
  courses             Course[]              @relation("BundleCourses")
  order               Order[]

  @@map("course_bundles")
}

model CourseBundleCourses {
  bundleId String
  courseId String

  bundle CourseBundle @relation(fields: [bundleId], references: [id])
  course Course       @relation(fields: [courseId], references: [id])

  @@id([bundleId, courseId])
  @@map("course_bundle_courses")
}

model Cart {
  id        String         @id @default(uuid())
  userId    String
  modelType CartModelType
  bookId    String?
  courseId  String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   User    @relation(fields: [userId], references: [id])
  book   Book?   @relation(fields: [bookId], references: [id])
  course Course? @relation(fields: [courseId], references: [id])

  @@map("carts")
}

model Order {
  id             String         @id @default(uuid())
  userId         String
  authorId       String
  modelType      OrderModelType
  bookId         String?
  courseId       String?
  courseBundleId String?
  eventId        String?

  amount          Float
  discount        Float?
  finalAmount     Float // after discount
  instructorShare Float
  platformShare   Float
  affiliateShare  Float? @default(0)

  status        OrderStatus   @default(pending)
  paymentStatus PaymentStatus @default(unpaid)
  paymentMethod PaymentMethod @default(Stripe)
  transactionId String?
  documents     String?
  isDeleted     Boolean       @default(false)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  user         User          @relation("UserOrder", fields: [userId], references: [id])
  author       User          @relation("AuthorOrder", fields: [authorId], references: [id])
  book         Book?         @relation(fields: [bookId], references: [id])
  course       Course?       @relation(fields: [courseId], references: [id])
  courseBundle CourseBundle? @relation(fields: [courseBundleId], references: [id])
  event        Event?        @relation(fields: [eventId], references: [id])

  payment       Payment[]
  affiliateSale AffiliateSale?

  @@map("orders")
}

model Quiz {
  id           String   @id @default(uuid())
  authorId     String
  courseId     String
  deadline     String?
  time         Int      @default(0)
  marks        Int      @default(0)
  questions    Int      @default(0)
  totalAttempt Int      @default(0)
  isDeleted    Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  course        Course        @relation(fields: [courseId], references: [id])
  author        User          @relation(fields: [authorId], references: [id])
  questionsList Question[]
  quizAttempt   QuizAttempt[]

  @@map("quizzes")
}

model Question {
  id        String   @id @default(uuid())
  quizId    String
  name      String
  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  quiz       Quiz         @relation(fields: [quizId], references: [id])
  options    Options[]
  quizAnswer QuizAnswer[]

  @@map("questions")
}

model Options {
  id          String   @id @default(uuid())
  questionId  String
  optionLevel String // e.g. A, B, C, D
  optionText  String
  isCorrect   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  question   Question     @relation(fields: [questionId], references: [id])
  quizAnswer QuizAnswer[]

  @@map("options")
}

model QuizAttempt {
  id            String      @id @default(uuid())
  quizId        String
  userId        String
  authorId      String
  timeTaken     Int?
  marksObtained Int         @default(0)
  totalMarks    Int         @default(0)
  grade         CourseGrade @default(NA)
  correctRate   Float       @default(0.0)
  lastAttempt   DateTime    @default(now())
  isCompleted   Boolean     @default(false)
  isDeleted     Boolean     @default(false)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  // Relations
  quiz       Quiz         @relation(fields: [quizId], references: [id])
  user       User         @relation("quizAttemptUser", fields: [userId], references: [id])
  author     User         @relation("quizAuthor", fields: [authorId], references: [id])
  quizAnswer QuizAnswer[]

  @@map("quiz_attempts")
}

model QuizAnswer {
  id         String   @id @default(uuid())
  attemptId  String
  questionId String
  optionId   String
  isCorrect  Boolean
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  attempt  QuizAttempt @relation(fields: [attemptId], references: [id])
  question Question    @relation(fields: [questionId], references: [id])
  option   Options     @relation(fields: [optionId], references: [id])

  @@map("quiz_answers")
}

model EnrolledCourse {
  id             String       @id @default(uuid())
  userId         String
  authorId       String
  courseId       String
  platform       PlatformType @default(admin)
  courseCategory String
  completedRate  Int          @default(0)
  courseMark     Int?         @default(0)
  grade          CourseGrade?
  learningTime   Int          @default(0) // in minutes
  lectureWatched Int          @default(0)
  lastActivity   DateTime     @default(now())
  isComplete     Boolean      @default(false)
  isDeleted      Boolean      @default(false)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  user   User   @relation("EnrolledUser", fields: [userId], references: [id])
  author User   @relation("CourseAuthor", fields: [authorId], references: [id])
  course Course @relation(fields: [courseId], references: [id])

  // Many-to-many relation with CourseContent
  watchedLectures CourseContent[] @relation("CourseLectureWatched")

  @@map("enrolled_courses")
}

model Assignment {
  id          String    @id @default(uuid())
  authorId    String // Company Admin or Business Instructor
  courseId    String
  title       String
  description String?
  fileUrl     String? // e.g., PDF/DOC/ZIP link
  marks       Int
  deadline    DateTime?
  attempt     Int       @default(0)
  isDeleted   Boolean   @default(false)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  author User   @relation(fields: [authorId], references: [id])
  course Course @relation(fields: [courseId], references: [id])

  // Submissions relation (for trainees)
  submissions AssignmentSubmission[]

  @@map("assignments")
}

model AssignmentSubmission {
  id             String       @id @default(uuid())
  assignmentId   String
  authorId       String
  userId         String
  fileUrl        String?
  submittedText  String?
  grade          CourseGrade?
  marksObtained  Int          @default(0)
  totalMarks     Int          @default(0)
  feedback       String?
  submittedAt    DateTime     @default(now())
  isLate         Boolean      @default(false)
  isReSubmission Boolean      @default(false)
  isChecked      Boolean      @default(false)
  isDeleted      Boolean      @default(false)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  // Relations
  assignment Assignment @relation(fields: [assignmentId], references: [id])
  user       User       @relation("assignmentSubmissionUser", fields: [userId], references: [id])
  author     User       @relation("assignmentAuthorUser", fields: [authorId], references: [id])

  @@map("assignment_submissions")
}

model CertificateRequest {
  id        String                   @id @default(uuid())
  userId    String // FK to User (course author)
  authorId  String // FK to User (student requesting)
  courseId  String
  status    CertificateRequestStatus @default(pending)
  createdAt DateTime                 @default(now())
  updatedAt DateTime                 @updatedAt

  // Relations
  author User   @relation("authorRequest", fields: [authorId], references: [id])
  user   User   @relation("studentRequest", fields: [userId], references: [id])
  course Course @relation(fields: [courseId], references: [id])

  @@map("certificate_requests")
}

model Certificate {
  id           String   @id @default(uuid())
  authorId     String
  userId       String
  courseId     String
  company      String?
  logo         String?
  student      String?
  courseName   String?
  instructor   String?
  studyHour    Float    @default(0.0)
  topics       String[] @default([])
  completeDate String?
  reference    String?
  signature    String?
  isCompleted  Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  course Course @relation(fields: [courseId], references: [id])
  author User   @relation("AuthorCertificate", fields: [authorId], references: [id])
  user   User   @relation("UserCertificate", fields: [userId], references: [id])

  @@map("certificates")
}

//* Event Related Models
model Event {
  id             String       @id @default(uuid())
  authorId       String
  companyId      String?
  platform       PlatformType @default(admin)
  title          String
  type           EventType    @default(in_person)
  slogan         String
  category       String
  thumbnail      String
  organizedBy    String
  price          Int
  location       String
  language       String
  date           String
  startTime      String
  endTime        String
  description    String
  speakerSlogan  String
  scheduleSlogan String
  registered     Int          @default(0)
  isDeleted      Boolean      @default(false)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  author  User     @relation(fields: [authorId], references: [id])
  company Company? @relation(fields: [companyId], references: [id])

  eventBooking      EventBooking[]
  eventSchedule     EventSchedule[]
  eventSpeaker      EventSpeaker[]
  MeetingAssignment MeetingAssignment[]
  coupon            Coupon[]
  promoCode         PromoCode[]
  resource          Resource[]
  affiliateLink     AffiliateLink[]
  order             Order[]

  @@map("events")
}

model EventSchedule {
  id        String   @id @default(uuid())
  eventId   String
  day       String
  date      String
  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  event        Event          @relation(fields: [eventId], references: [id])
  eventSpeaker EventSpeaker[]

  @@map("event_schedules")
}

model EventSpeaker {
  id              String   @id @default(uuid())
  eventId         String
  eventScheduleId String
  name            String
  photo           String?
  profession      String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  event    Event         @relation(fields: [eventId], references: [id])
  schedule EventSchedule @relation(fields: [eventScheduleId], references: [id])

  @@map("event_speakers")
}

model EventBooking {
  id           String   @id @default(uuid())
  eventId      String
  userId       String
  authorId     String
  name         String
  phone        String
  email        String
  organization String
  profession   String
  city         String
  country      String
  amount       Float
  document     String?
  isDeleted    Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  event  Event @relation(fields: [eventId], references: [id])
  user   User  @relation("userEventBooking", fields: [userId], references: [id])
  author User  @relation("authorEventBooking", fields: [authorId], references: [id])

  @@map("event_bookings")
}

model Coupon {
  id       String @id @default(uuid())
  authorId String // FK → User (who created the coupon)

  modelType CouponModel // Enum to represent reference type (Course, Event, etc.)
  bookId    String?
  courseId  String?
  eventId   String?

  name      String
  code      String   @unique
  discount  Float
  maxUsage  Int?
  usedCount Int      @default(0)
  expireAt  DateTime
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  author User   @relation("CouponCreated", fields: [authorId], references: [id])
  usedBy User[] @relation("CouponUsedBy")

  book   Book?   @relation(fields: [bookId], references: [id])
  course Course? @relation(fields: [courseId], references: [id])
  event  Event?  @relation(fields: [eventId], references: [id])

  @@map("coupons")
}

model PromoCode {
  id        String         @id @default(uuid())
  authorId  String
  modelType PromoCodeModel
  bookId    String?
  courseId  String?
  eventId   String?
  name      String
  code      String         @unique
  discount  Float
  maxUsage  Int?
  usedCount Int            @default(0)
  expireAt  DateTime
  isActive  Boolean        @default(true)
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt

  author User?   @relation(fields: [authorId], references: [id])
  usedBy User[]  @relation("PromoCodeUsedBy")
  book   Book?   @relation(fields: [bookId], references: [id])
  course Course? @relation(fields: [courseId], references: [id])
  event  Event?  @relation(fields: [eventId], references: [id])

  @@map("promo_codes")
}

model Affiliate {
  id             String   @id @default(uuid())
  userId         String   @unique
  commissionRate Float    @default(0.2) // 20% default
  totalClicks    Int      @default(0)
  totalSales     Int      @default(0)
  totalEarnings  Float    @default(0)
  pendingAmount  Float    @default(0)
  paidAmount     Float    @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  user           User            @relation(fields: [userId], references: [id])
  affiliateLinks AffiliateLink[]
  affiliateSales AffiliateSale[]

  @@map("affiliates")
}

model AffiliateLink {
  id          String         @id @default(uuid())
  affiliateId String
  modelType   AffiliateModel
  bookId      String?
  courseId    String?
  eventId     String?
  link        String         @unique
  clicks      Int            @default(0)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  affiliate Affiliate @relation(fields: [affiliateId], references: [id])
  course    Course?   @relation(fields: [courseId], references: [id])
  book      Book?     @relation(fields: [bookId], references: [id])
  event     Event?    @relation(fields: [eventId], references: [id])

  @@map("affiliate_links")
}

model AffiliateSale {
  id          String   @id @default(uuid())
  affiliateId String
  authorId    String
  orderId     String   @unique
  commission  Float    @default(0.0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  author    User      @relation(fields: [authorId], references: [id])
  affiliate Affiliate @relation(fields: [affiliateId], references: [id])
  order     Order     @relation(fields: [orderId], references: [id])

  @@map("affiliate_sales")
}

model Package {
  id           String              @id @default(uuid())
  title        String
  type         String
  logo         String
  audience     PackageAudience
  features     String[]
  billingCycle PackageBillingCycle
  price        Int
  popularity   Int                 @default(0)
  isDeleted    Boolean             @default(false)
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt

  subscription Subscription?

  @@map("packages")
}

model Subscription {
  id            String             @id @default(uuid())
  packageId     String             @unique
  userId        String             @unique
  type          SubscriptionType
  transactionId String?
  amount        Float
  paymentStatus PaymentStatus
  status        SubscriptionStatus
  expiredAt     DateTime           @default(now())
  isExpired     Boolean            @default(false)
  isDeleted     Boolean            @default(false)
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt

  package Package   @relation(references: [id], fields: [packageId])
  user    User      @relation(references: [id], fields: [userId])
  payment Payment[]

  @@map("subscriptions")
}

model Payment {
  id                String           @id @default(uuid())
  userId            String
  authorId          String
  companyId         String?
  orderId           String?
  subscriptionId    String?
  modelType         PaymentModelType
  type              PaymentType
  platform          PlatformType
  transactionId     String           @unique
  amount            Float            @default(0.00)
  adminEarning      Float            @default(0.00)
  instructorEarning Float            @default(0.00)
  coInstructorPool  Float            @default(0.00)
  status            PaymentStatus    @default(unpaid)
  paymentMethod     PaymentMethod
  paymentIntentId   String?
  isPaid            Boolean          @default(false)
  isSellerPaid      Boolean          @default(false)
  isDeleted         Boolean          @default(false)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  account             User                  @relation("PaymentUserAccount", references: [id], fields: [userId])
  author              User                  @relation("PaymentAuthorAccount", references: [id], fields: [authorId])
  order               Order?                @relation(fields: [orderId], references: [id])
  subscription        Subscription?         @relation(fields: [subscriptionId], references: [id])
  companies           Company?              @relation(fields: [companyId], references: [id])
  coInstructorEarning CoInstructorEarning[]

  @@map("payments")
}

model CoInstructorEarning {
  id             String    @id @default(uuid())
  coInstructorId String
  paymentId      String
  amount         Float     @default(0.00)
  isWithdrawn    Boolean   @default(false)
  withdrawnAt    DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  // Relations
  coInstructor CoInstructor @relation(fields: [coInstructorId], references: [id])
  payment      Payment      @relation(fields: [paymentId], references: [id])

  @@map("co_instructor_earnings")
}

model Batch {
  id       String @id @default(uuid())
  authorId String // FK → User (Instructor / Creator)

  title       String
  description String
  logo        String?
  category    String
  rarity      String?
  popularity  Int     @default(0)

  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  author User @relation(fields: [authorId], references: [id])

  @@map("batches")
}

model Review {
  id        String   @id @default(uuid())
  authorId  String
  courseId  String
  rating    Float
  comment   String
  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  author    User        @relation(fields: [authorId], references: [id])
  course    Course?     @relation(references: [id], fields: [courseId])
  reviewRef ReviewRef[]

  @@map("reviews")
}

model ReviewRef {
  id        String   @id @default(uuid())
  userId    String
  reviewId  String
  comment   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  author User   @relation(references: [id], fields: [userId])
  review Review @relation(references: [id], fields: [reviewId])

  @@map("review_refs")
}

model WithdrawRequest {
  id               String         @id @default(uuid())
  userId           String
  amount           Float
  stripeTransferId String?
  paymentMethod    PaymentMethod
  status           WithdrawStatus @default(pending)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt

  user User @relation(fields: [userId], references: [id])

  @@map("withdraw_requests")
}

model CV {
  id          String   @id @default(uuid())
  userId      String   @unique
  name        String
  designation String
  photo       String
  phone       String
  email       String
  linkedin    String
  website     String
  location    String
  aboutMe     String
  skills      String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user User @relation(fields: [userId], references: [id])

  educations   Education[]
  experiences  Experience[]
  certificates CVCertificate[]

  @@map("cvs")
}

model Education {
  id          String   @id @default(uuid())
  cvId        String
  institution String
  degree      String
  location    String
  result      String
  startTime   String
  endTime     String
  type        String // eg. GPA or CGPA
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  cv CV @relation(fields: [cvId], references: [id])

  @@map("educations")
}

model Experience {
  id          String   @id @default(uuid())
  cvId        String
  companyName String
  designation String
  jobType     String
  startTime   String
  endTime     String
  description String
  skills      String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  cv CV @relation(fields: [cvId], references: [id])

  @@map("experiences")
}

model CVCertificate {
  id            String   @id @default(uuid())
  cvId          String
  instituteName String
  degree        String
  credentialId  String
  file          String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  cv CV @relation(fields: [cvId], references: [id])

  @@map("cv_certificates")
}

model Notification {
  id          String               @id @default(uuid())
  receiverId  String?
  referenceId String?
  modeType    NotificationModeType
  message     String
  description String               @default("")
  date        DateTime             @default(now())
  read        Boolean              @default(false)
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt

  receiver User? @relation(fields: [receiverId], references: [id])

  @@map("notifications")
}

model Chat {
  id         String     @id @default(uuid())
  type       ChatType
  groupName  String? // Optional, for group chats
  groupImage String? // Optional, for group chats
  courseId   String? // if this is group chat
  isReadOnly Boolean    @default(false) // For Announcement chat
  status     ChatStatus @default(accepted)
  isDeleted  Boolean    @default(false)
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt

  course       Course?           @relation(fields: [courseId], references: [id])
  participants ChatParticipant[]
  messages     Message[]

  @@map("chats")
}

model ChatParticipant {
  id     String @id @default(uuid())
  userId String
  chatId String

  user User     @relation(fields: [userId], references: [id])
  chat Chat     @relation(fields: [chatId], references: [id])
  role ChatRole @default(member)

  @@unique([userId, chatId])
  @@map("chat_participants")
}

model Message {
  id         String   @id @default(uuid())
  senderId   String
  chatId     String
  receiverId String?
  text       String
  imageUrl   String[] @default([])
  seen       Boolean  @default(false)

  sender User @relation("SentMessages", fields: [senderId], references: [id])

  receiver User? @relation("ReceivedMessages", fields: [receiverId], references: [id])

  chat Chat @relation(fields: [chatId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("messages")
}

model Wishlist {
  id        String            @id @default(uuid())
  userId    String
  modelType WishListModelType
  bookId    String?
  courseId  String?
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt

  user   User    @relation(fields: [userId], references: [id])
  book   Book?   @relation(fields: [bookId], references: [id])
  course Course? @relation(fields: [courseId], references: [id])

  @@map("wishlists")
}

model Resource {
  id        String            @id @default(uuid())
  name      String
  modelType ResourceModelType
  authorId  String
  bookId    String?
  courseId  String?
  eventId   String?
  file      String
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt

  author User    @relation(fields: [authorId], references: [id])
  book   Book?   @relation(fields: [bookId], references: [id])
  course Course? @relation(fields: [courseId], references: [id])
  event  Event?  @relation(fields: [eventId], references: [id])

  @@map("resources")
}

model GradingSystem {
  id        String   @id @default(uuid())
  courseId  String?
  authorId  String
  isDefault Boolean  @default(false) // true = SuperAdmin template
  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  author User?   @relation(fields: [authorId], references: [id])
  course Course? @relation(fields: [courseId], references: [id])
  grades Grade[]

  @@map("grading_systems")
}

model Grade {
  id              String      @id @default(uuid())
  gradingSystemId String
  minScore        Float
  maxScore        Float
  gradeLabel      CourseGrade // e.g., "A", "B", "C"
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  gradingSystem GradingSystem @relation(fields: [gradingSystemId], references: [id])

  @@map("grades")
}

model Article {
  id          String   @id @default(uuid())
  authorId    String // FK to Admin
  title       String
  category    String
  thumbnail   String?
  description String
  seen        Int      @default(0)
  isDeleted   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  author User              @relation(fields: [authorId], references: [id])
  seenBy UsersOnArticles[] // ✅ join table for tracking who has seen

  @@map("articles")
}

model UsersOnArticles {
  userId    String
  articleId String
  seenAt    DateTime @default(now()) // ✅ track when they saw it

  user    User    @relation(fields: [userId], references: [id])
  article Article @relation(fields: [articleId], references: [id])

  @@id([userId, articleId]) // Composite PK
  @@map("users_on_articles")
}

model Content {
  id          String @id @default(uuid())
  createdById String // FK to User (admin/editor)

  aboutUs            String?
  termsAndConditions String?
  privacyPolicy      String?

  // Support / Contacts
  supports         String?
  customerLocation String?
  customerNumber   String?
  customerEmail    String?

  contractLocation String?
  contractNumber   String?
  contractEmail    String?

  officeLocation String?
  officeNumber   String?
  officeEmail    String?

  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  createdBy User @relation(fields: [createdById], references: [id])

  @@map("contents")
}

model FAQ {
  id       String @id @default(uuid())
  question String
  answer   String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("faqs")
}

model Support {
  id         String   @id @default(uuid())
  name       String
  email      String
  message    String
  isResponse Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("supports")
}

model Newsletter {
  id           String             @id @default(uuid())
  title        String
  content      String
  category     NewsletterCategory
  scheduleDate DateTime           @default(now())
  status       NewsletterStatus   @default(active)
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt

  @@map("newsletters")
}

model NewsletterSubscriber {
  id         String               @id @default(uuid())
  email      String
  name       String?
  category   NewsletterCategory[] // multiple preferences
  recurrence RecurrenceType       @default(once)
  status     NewsletterStatus     @default(active)
  createdAt  DateTime             @default(now())
  updatedAt  DateTime             @updatedAt

  // to prevent duplicate subscriptions
  @@unique([email, category], name: "unique_subscriber_email_category")
  @@map("newsletter_subscribers")
}

enum RegisterWith {
  google
  linkedIn
  facebook
  credentials
}

enum CourseType {
  internal
  external
}

enum CartModelType {
  book
  course
}

enum OrderModelType {
  book
  course
  courseBundle
  event
}

enum EventType {
  virtual
  in_person
}

enum AssignmentModelType {
  course
  event
  user
}

enum CourseGrade {
  A_PLUS
  A
  A_MINUS
  B_PLUS
  B
  B_MINUS
  C_PLUS
  C
  C_MINUS
  D_PLUS
  D
  D_MINUS
  F
  PASS
  FAIL
  NA
}

enum NewsletterCategory {
  promo
  coupon
  course_update
  shop
  blogs
  activityBased
  subscription
}

enum RecurrenceType {
  once
  daily
  weekly
  monthly
}

enum NewsletterStatus {
  active
  paused
  unsubscribed
}

enum UserRole {
  super_admin
  company_admin
  business_instructors
  employee
  instructor
  student
}

enum PackageAudience {
  company_admin
  instructor
}

enum PackageBillingCycle {
  monthly
  halfYearly
  annually
}

enum PaymentModelType {
  order
  subscription
}

enum PaymentType {
  course
  book
  event
  instructor_subscription
  company_subscription
}

enum PlatformType {
  company
  admin
}

enum CompanyType {
  ngo
  sme
  enterprise
}

enum CertificateRequestStatus {
  pending
  approved
  denied
}

enum ReviewModelType {
  instructor
  course
}

enum NotificationModeType {
  users
  shop
  course
  enrolled_courses
  event
  quiz_attempts
  assignment
  assignment_submissions
  order
  payment
  certificate
  batch
  withdraw_request
}

enum UserStatus {
  pending
  active
  denied
  blocked
  deleted
}

enum Permission {
  edit
  quiz
  resources
  grade
}

enum CoursesStatus {
  pending
  approved
  denied
}

enum BookStatus {
  inReview
  published
}

enum Gender {
  male
  female
  unknown
}

enum OrderStatus {
  pending
  completed
  cancelled
  refunded
}

enum WithdrawStatus {
  pending
  completed
  cancelled
}

enum CourseLevel {
  beginner
  intermediate
  advanced
  expert
}

enum CouponModel {
  courses
  events
  books
}

enum PromoCodeModel {
  courses
  events
  books
}

enum AffiliateModel {
  courses
  events
  books
}

enum PaymentStatus {
  unpaid
  paid
  failed
  refunded
}

enum ChatStatus {
  accepted
  blocked
}

enum SubscriptionType {
  basic
  standard
  premium
  non_profits
  most_popular
  full_power
}

enum SubscriptionStatus {
  pending
  active
  cancelled
  expired
}

enum PaymentMethod {
  Stripe
  PayPal
  BankTransfer
}

enum ChatType {
  private
  group
  announcement
}

enum WishListModelType {
  course
  book
}

enum ResourceModelType {
  course
  event
  book
}

enum ChatRole {
  admin
  member
}
