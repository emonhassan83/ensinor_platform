// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         String     @id @default(uuid())
  email      String     @unique
  password   String
  role       UserRole
  lastActive DateTime   @default(now())
  status     UserStatus @default(active)
  isDeleted  Boolean    @default(false)
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt

  superAdmin         SuperAdmin?
  companyAdmin       CompanyAdmin?
  businessInstructor BusinessInstructor?
  employee           Employee?
  instructor         Instructor?
  student            Student?
  subscription       Subscription?
  payment            Payment?
  review             Review?
  ReviewRef          ReviewRef?

  @@map("users")
}

model SuperAdmin {
  id          String     @id @unique @default(uuid())
  userId      String     @unique
  name        String
  email       String     @unique
  photoUrl    String
  dateOfBirth String
  contactNo   String
  city        String?
  country     String?
  status      UserStatus @default(active)
  isDeleted   Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  user User @relation(references: [id], fields: [userId])

  @@map("super_admin")
}

model CompanyAdmin {
  id          String     @id @unique @default(uuid())
  userId      String     @unique
  name        String
  email       String     @unique
  photoUrl    String
  dateOfBirth String
  contactNo   String
  city        String?
  country     String?
  status      UserStatus @default(active)
  isDeleted   Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  user               User                @relation(references: [id], fields: [userId])
  businessInstructor BusinessInstructor?
  employee           Employee?
  company            Company?

  @@map("company_admins")
}

model BusinessInstructor {
  id          String     @id @unique @default(uuid())
  userId      String     @unique
  companyId   String     @unique
  name        String
  email       String     @unique
  photoUrl    String
  dateOfBirth String
  contactNo   String
  city        String?
  country     String?
  status      UserStatus @default(active)
  isDeleted   Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  user    User         @relation(references: [id], fields: [userId])
  company CompanyAdmin @relation(references: [id], fields: [companyId])

  @@map("business_instructors")
}

model Employee {
  id          String     @id @unique @default(uuid())
  userId      String     @unique
  companyId   String     @unique
  name        String
  email       String     @unique
  photoUrl    String
  dateOfBirth String
  contactNo   String
  city        String?
  country     String?
  status      UserStatus @default(active)
  isDeleted   Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  user    User         @relation(references: [id], fields: [userId])
  company CompanyAdmin @relation(references: [id], fields: [companyId])

  @@map("employees")
}

model Instructor {
  id          String     @id @unique @default(uuid())
  userId      String     @unique
  name        String
  email       String     @unique
  photoUrl    String
  contactNo   String
  designation String
  bio         String?
  city        String?
  country     String?
  university  String?
  session     String?
  subjects    String
  linkedIn    String?
  facebook    String?
  twitter     String?
  instagram   String?
  website     String?
  avgRating   Float      @default(0.0)
  ratingCount Int        @default(0)
  status      UserStatus @default(active)
  isDeleted   Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  user User @relation(references: [id], fields: [userId])

  @@map("instructors")
}

model Student {
  id          String     @id @unique @default(uuid())
  userId      String     @unique
  name        String
  email       String     @unique
  photoUrl    String
  bio         String?
  interests   String[]
  dateOfBirth String
  contactNo   String
  city        String?
  country     String?
  university  String?
  session     String?
  subjects    String
  status      UserStatus @default(active)
  isDeleted   Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  user User @relation(references: [id], fields: [userId])

  @@map("students")
}

model Company {
  id           String     @id @default(uuid())
  userId       String     @unique
  name         String
  industryType String
  logo         String?
  color        String?
  employee     Int        @default(0)
  instructor   Int        @default(0)
  size         Int        @default(0)
  status       UserStatus @default(active)
  isDeleted    Boolean    @default(false)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  author CompanyAdmin @relation(references: [id], fields: [userId])

  @@map("companies")
}

model Package {
  id           String              @id @default(uuid())
  title        String
  logo         String
  audience     PackageAudience
  features     String[]
  billingCycle PackageBillingCycle
  price        Int
  popularity   Int                 @default(0)
  isDeleted    Boolean             @default(false)
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  subscription Subscription?

  @@map("packages")
}

model Subscription {
  id            String        @id @default(uuid())
  packageId     String        @unique
  userId        String        @unique
  transactionId String?
  amount        Float
  paymentStatus PaymentStatus
  status        PaymentStatus
  expiredAt     DateTime      @default(now())
  isExpired     Boolean       @default(false)
  isDeleted     Boolean       @default(false)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  package Package @relation(references: [id], fields: [packageId])
  user    User    @relation(references: [id], fields: [userId])

  @@map("subscriptions")
}

model Payment {
  id              String           @id @default(uuid())
  userId          String           @unique
  referenceId     String
  modelType       PaymentModelType
  transactionId   String           @unique
  amount          Float            @default(0.00)
  commission      Float            @default(0.00)
  status          PaymentStatus    @default(unpaid)
  paymentMethod   String
  paymentIntentId String?
  isPaid          Boolean          @default(false)
  isSellerPaid    Boolean          @default(false)
  isDeleted       Boolean          @default(false)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  account User @relation(references: [id], fields: [userId])
  // reference User @relation(references: [id], fields: [userId])

  @@map("payments")
}

model Review {
  id          String          @id @default(uuid())
  userId      String          @unique
  referenceId String
  modelType   ReviewModelType
  rating      Float
  comment     String
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  author    User       @relation(references: [id], fields: [userId])
  ReviewRef ReviewRef?

  @@map("reviews")
}

model ReviewRef {
  id        String   @id @default(uuid())
  userId    String   @unique
  reviewId  String   @unique
  comment   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  author User   @relation(references: [id], fields: [userId])
  review Review @relation(references: [id], fields: [reviewId])

  @@map("review_refs")
}

enum UserRole {
  super_admin
  company_admin
  business_instructors
  employee
  instructor
  student
}

enum PackageAudience {
  company_admin
  student
}

enum PackageBillingCycle {
  monthly
  halfYearly
  annually
}

enum PaymentModelType {
  order
  subscription
  eventBooking
  enrolledCourse
}

enum ReviewModelType {
  instructor
  course
}

enum UserStatus {
  pending
  active
  blocked
  deleted
}

enum Gender {
  male
  female
  unknown
}

enum PaymentStatus {
  unpaid
  paid
}
